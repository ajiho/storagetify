{"version":3,"file":"storagetify.esm.min.js","sources":["../src/js/TagSet.js","../src/js/index.js"],"sourcesContent":["/**\r\n *  标签集合\r\n */\r\nclass TagSet {\r\n  constructor(tag, cache) {\r\n    //标签的缓存Key\r\n    this.tag = Array.isArray(tag) ? tag : [tag]\r\n\r\n    //缓存句柄\r\n    this.handler = cache\r\n  }\r\n\r\n  set(key, value, expire = null) {\r\n    this.handler.set(key, value, expire)\r\n\r\n    this.append(key)\r\n  }\r\n\r\n  append(key) {\r\n    for (const tag of this.tag) {\r\n      //读取标签\r\n      const tagItems = this.handler.getTagItems(tag)\r\n\r\n      //判断标签是否在数组里,不再就直接加入\r\n      if (!tagItems.includes(key)) {\r\n        //加入数组\r\n        tagItems.push(key)\r\n\r\n        //重新设置回去\r\n        this.handler.set(tag, tagItems)\r\n      }\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const tag of this.tag) {\r\n      const tagItems = this.handler.getTagItems(tag)\r\n\r\n      //分别遍历删除所有的缓存\r\n      for (const cacheKey of tagItems) {\r\n        this.handler.delete(cacheKey)\r\n      }\r\n      //再删除标签\r\n      this.handler.delete(tag)\r\n    }\r\n  }\r\n}\r\n\r\nexport default TagSet\r\n","import TagSet from './TagSet'\r\n\r\nclass Storagetify {\r\n  \r\n  constructor(options = {}) {\r\n    this.type = options.type || 'local' //默认驱动是 localStorage\r\n    this.expire = options.expire || 0\r\n    this.prefix = options.prefix || ''\r\n    this.serialize = options.serialize || JSON.stringify\r\n    this.deserialize = options.deserialize || JSON.parse\r\n    this.storage = window[`${this.type}Storage`]\r\n  }\r\n\r\n  getKey(key) {\r\n    return this.prefix + key\r\n  }\r\n\r\n  set(key, value, expire = null) {\r\n    const cacheValue = {\r\n      value,\r\n      expire:\r\n        expire || this.expire !== 0\r\n          ? Date.now() + (expire || this.expire) * 1000\r\n          : 0,\r\n    }\r\n    try {\r\n      this.storage.setItem(this.getKey(key), this.serialize(cacheValue))\r\n      return true\r\n    } catch (error) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  has(key) {\r\n    return this.storage.getItem(this.getKey(key)) !== null\r\n  }\r\n\r\n  get(key, defaultValue = null) {\r\n    const cacheValue = this.storage.getItem(this.getKey(key))\r\n    if (cacheValue) {\r\n      const parsedValue = this.deserialize(cacheValue)\r\n      if (parsedValue.expire === 0 || parsedValue.expire >= Date.now()) {\r\n        return parsedValue.value\r\n      }\r\n      this.delete(key)\r\n    }\r\n    return defaultValue\r\n  }\r\n\r\n  delete(key) {\r\n    this.storage.removeItem(this.getKey(key))\r\n  }\r\n\r\n  clear() {\r\n    this.storage.clear()\r\n  }\r\n\r\n  remember(key, value, expire = null) {\r\n    const cachedValue = this.get(key)\r\n    if (cachedValue !== null) {\r\n      return cachedValue\r\n    }\r\n\r\n    if (typeof value === 'function') {\r\n      //允许第二个参数是一个函数\r\n      const computedValue = value()\r\n      this.set(key, computedValue, expire)\r\n      return computedValue\r\n    }\r\n    this.set(key, value, expire)\r\n    return value\r\n  }\r\n\r\n  inc(key, step = 1) {\r\n    const cachedValue = this.get(key, 0)\r\n    if (typeof cachedValue === 'number') {\r\n      this.set(key, cachedValue + step)\r\n    }\r\n  }\r\n\r\n  tag(tag) {\r\n    return new TagSet(tag, this)\r\n  }\r\n\r\n  dec(key, step = 1) {\r\n    this.inc(key, -step)\r\n  }\r\n\r\n  //获取并删除缓存\r\n  pull(key) {\r\n    let value = this.get(key)\r\n    this.delete(key)\r\n    return value\r\n  }\r\n\r\n  push(key, value) {\r\n    const cachedValue = this.get(key, [])\r\n    if (Array.isArray(cachedValue)) {\r\n      cachedValue.push(value)\r\n      this.set(key, cachedValue)\r\n    }\r\n  }\r\n\r\n  store(type) {\r\n    return new this.constructor({\r\n      type,\r\n      expire: this.expire,\r\n      prefix: this.prefix,\r\n      serialize: this.serialize,\r\n      deserialize: this.deserialize,\r\n    })\r\n  }\r\n\r\n  getTagItems(tag) {\r\n    return this.get(tag, [])\r\n  }\r\n}\r\n\r\nexport default Storagetify\r\n"],"names":["TagSet","constructor","tag","cache","this","Array","isArray","handler","set","key","value","expire","append","tagItems","getTagItems","includes","push","clear","cacheKey","delete","Storagetify","options","type","prefix","serialize","JSON","stringify","deserialize","parse","storage","window","getKey","cacheValue","Date","now","setItem","error","has","getItem","get","defaultValue","parsedValue","removeItem","remember","cachedValue","computedValue","inc","step","dec","pull","store"],"mappings":"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"}