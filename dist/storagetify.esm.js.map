{"version":3,"file":"storagetify.esm.js","sources":["../src/js/TagSet.js","../src/js/index.js"],"sourcesContent":["/**\r\n *  标签集合\r\n */\r\nclass TagSet {\r\n  constructor(tag, cache) {\r\n    //标签的缓存Key\r\n    this.tag = Array.isArray(tag) ? tag : [tag]\r\n\r\n    //缓存句柄\r\n    this.handler = cache\r\n  }\r\n\r\n  set(key, value, expire = null) {\r\n    this.handler.set(key, value, expire)\r\n\r\n    this.append(key)\r\n  }\r\n\r\n  append(key) {\r\n    for (const tag of this.tag) {\r\n      //读取标签\r\n      const tagItems = this.handler.getTagItems(tag)\r\n\r\n      //判断标签是否在数组里,不再就直接加入\r\n      if (!tagItems.includes(key)) {\r\n        //加入数组\r\n        tagItems.push(key)\r\n\r\n        //重新设置回去\r\n        this.handler.set(tag, tagItems)\r\n      }\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const tag of this.tag) {\r\n      const tagItems = this.handler.getTagItems(tag)\r\n\r\n      //分别遍历删除所有的缓存\r\n      for (const cacheKey of tagItems) {\r\n        this.handler.delete(cacheKey)\r\n      }\r\n      //再删除标签\r\n      this.handler.delete(tag)\r\n    }\r\n  }\r\n}\r\n\r\nexport default TagSet\r\n","import TagSet from './TagSet'\r\n\r\nclass Storagetify {\r\n  \r\n  constructor(options = {}) {\r\n    this.type = options.type || 'local' //默认驱动是 localStorage\r\n    this.expire = options.expire || 0\r\n    this.prefix = options.prefix || ''\r\n    this.serialize = options.serialize || JSON.stringify\r\n    this.deserialize = options.deserialize || JSON.parse\r\n    this.storage = window[`${this.type}Storage`]\r\n  }\r\n\r\n  getKey(key) {\r\n    return this.prefix + key\r\n  }\r\n\r\n  set(key, value, expire = null) {\r\n    const cacheValue = {\r\n      value,\r\n      expire:\r\n        expire || this.expire !== 0\r\n          ? Date.now() + (expire || this.expire) * 1000\r\n          : 0,\r\n    }\r\n    try {\r\n      this.storage.setItem(this.getKey(key), this.serialize(cacheValue))\r\n      return true\r\n    } catch (error) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  has(key) {\r\n    return this.storage.getItem(this.getKey(key)) !== null\r\n  }\r\n\r\n  get(key, defaultValue = null) {\r\n    const cacheValue = this.storage.getItem(this.getKey(key))\r\n    if (cacheValue) {\r\n      const parsedValue = this.deserialize(cacheValue)\r\n      if (parsedValue.expire === 0 || parsedValue.expire >= Date.now()) {\r\n        return parsedValue.value\r\n      }\r\n      this.delete(key)\r\n    }\r\n    return defaultValue\r\n  }\r\n\r\n  delete(key) {\r\n    this.storage.removeItem(this.getKey(key))\r\n  }\r\n\r\n  clear() {\r\n    this.storage.clear()\r\n  }\r\n\r\n  remember(key, value, expire = null) {\r\n    const cachedValue = this.get(key)\r\n    if (cachedValue !== null) {\r\n      return cachedValue\r\n    }\r\n\r\n    if (typeof value === 'function') {\r\n      //允许第二个参数是一个函数\r\n      const computedValue = value()\r\n      this.set(key, computedValue, expire)\r\n      return computedValue\r\n    }\r\n    this.set(key, value, expire)\r\n    return value\r\n  }\r\n\r\n  inc(key, step = 1) {\r\n    const cachedValue = this.get(key, 0)\r\n    if (typeof cachedValue === 'number') {\r\n      this.set(key, cachedValue + step)\r\n    }\r\n  }\r\n\r\n  tag(tag) {\r\n    return new TagSet(tag, this)\r\n  }\r\n\r\n  dec(key, step = 1) {\r\n    this.inc(key, -step)\r\n  }\r\n\r\n  //获取并删除缓存\r\n  pull(key) {\r\n    let value = this.get(key)\r\n    this.delete(key)\r\n    return value\r\n  }\r\n\r\n  push(key, value) {\r\n    const cachedValue = this.get(key, [])\r\n    if (Array.isArray(cachedValue)) {\r\n      cachedValue.push(value)\r\n      this.set(key, cachedValue)\r\n    }\r\n  }\r\n\r\n  store(type) {\r\n    return new this.constructor({\r\n      type,\r\n      expire: this.expire,\r\n      prefix: this.prefix,\r\n      serialize: this.serialize,\r\n      deserialize: this.deserialize,\r\n    })\r\n  }\r\n\r\n  getTagItems(tag) {\r\n    return this.get(tag, [])\r\n  }\r\n}\r\n\r\nexport default Storagetify\r\n"],"names":["TagSet","constructor","tag","cache","Array","isArray","handler","set","key","value","expire","append","tagItems","getTagItems","includes","push","clear","cacheKey","delete","Storagetify","options","type","prefix","serialize","JSON","stringify","deserialize","parse","storage","window","getKey","cacheValue","Date","now","setItem","error","has","getItem","get","defaultValue","parsedValue","removeItem","remember","cachedValue","computedValue","inc","step","dec","pull","store"],"mappings":"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"}